  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>GObject tutorial</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      pre{overflow: visible;}
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::after
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
      div.sourceCode { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      pre:not(.sourceCode) { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      table {margin-left: auto; margin-right: auto; border-collapse: collapse; border: 1px solid;}
      th {padding: 2px 6px; border: 1px solid; background-color: ghostwhite;}
      td {padding: 2px 6px; border: 1px solid;}
      img {display: block; margin-left: auto; margin-right: auto;}
      figcaption {text-align: center;}
    </style>
  </head>
  <body style="padding-top: 70px;">
    <div class="container">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <span class="navbar-brand">Gtk4 tutorial</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
<a class="nav-link" href="index.html">Home</a>
</li>

            <li class="nav-item">
<a class="nav-link" href="sec8.html">Prev: section8</a>
</li>

            
          </ul>
        </div>
      </div>
    </nav>
<h1 id="interface">Interface</h1>
<p>Interface is similar to abstract class. Interface defines virtual functions which are expected to be overridden by a function in another instantiable object.</p>
<p>This section provides a simple example, TComparable. TComparable is an interface. It defines functions to compare. They are:</p>
<ul>
<li><code>t_comparable_cmp (self, other)</code> compares <code>self</code> and <code>other</code>. <code>self</code> is an instance on which <code>t_comparable_cmp</code> runs. <code>other</code> is another instance. This function needs to be overridden in an object which implements the interface.
<ul>
<li>If <code>self</code> is equal to <code>other</code>, <code>t_comparable_cmp</code> returns 0.</li>
<li>If <code>self</code> is greater than <code>other</code>, <code>t_comparable_cmp</code> returns 1.</li>
<li>If <code>self</code> is less than <code>other</code>, <code>t_comparable_cmp</code> returns -1.</li>
<li>If an error happens, <code>t_comparable_cmp</code> returns -2.</li>
</ul></li>
<li><code>t_comparable_eq (self, other)</code> returns TRUE if <code>self</code> is equal to <code>other</code>. Otherwise it returns FALSE. You need to be careful that FALSE is returned even if an error occurs.</li>
<li><code>t_comparable_gt (self, other)</code> returns TRUE if <code>self</code> is greater than <code>other</code>. Otherwise it returns FALSE.</li>
<li><code>t_comparable_lt (self, other)</code> returns TRUE if <code>self</code> is less than <code>other</code>. Otherwise it returns FALSE.</li>
<li><code>t_comparable_ge (self, other)</code> returns TRUE if <code>self</code> is greater than or equal to <code>other</code>. Otherwise it returns FALSE.</li>
<li><code>t_comparable_le (self, other)</code> returns TRUE if <code>self</code> is less than or equal to <code>other</code>. Otherwise it returns FALSE.</li>
</ul>
<p>Numbers and strings are comparable. TInt, TDouble, TStr and TNumStr implement TComparable interface so that they can use the functions above. For example,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>TInt *i1 = t_int_new_with_value (<span class="dv">10</span>);</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>TInt *i2 = t_int_new_with_value (<span class="dv">20</span>);</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>t_comparable_eq (T_COMPARABLE (i1), T_COMPARABLE (i2)); <span class="co">/* It returns FALSE */</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>t_comparable_lt (T_COMPARABLE (i1), T_COMPARABLE (i2)); <span class="co">/* It returns TRUE */</span></span></code></pre></div>
<p>What’s the difference between interface and abstract class? Virtual functions in an abstract class are overridden by a function in its descendant classes. Virtual functions in an interface are overridden by a function in any classes. Compare TNumber and TComparable.</p>
<ul>
<li>A function <code>t_number_add</code> is overridden in TIntClass and TDoubleClass. It can’t be overridden in TStrClass because TStr isn’t a descendant of TNumber.</li>
<li>A function <code>t_comparable_cmp</code> is overridden in TIntClass, TDoubleClass, TStrClass and TNumStrClass.</li>
</ul>
<h2 id="tcomparable-interface">TComparable interface</h2>
<p>Defining interfaces is similar to define objects.</p>
<ul>
<li>Use <code>G_DECLARE_INTERFACE</code> instead of <code>G_DEFINE_FINAL_TYPE</code>.</li>
<li>Use <code>G_DEFINE_INTERFACE</code> instead of <code>G_DEFINE_TYPE</code>.</li>
</ul>
<p>Now let’s see the header file.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1"></a><span class="pp">#ifndef __T_COMPARABLE_H__</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="pp">#define __T_COMPARABLE_H__</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="pp">#define T_TYPE_COMPARABLE  (t_comparable_get_type ())</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>G_DECLARE_INTERFACE (TComparable, t_comparable, T, COMPARABLE, GObject)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">struct</span> _TComparableInterface {</span>
<span id="cb2-10"><a href="#cb2-10"></a>  GTypeInterface parent;</span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="co">/* signal */</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="dt">void</span> (*arg_error) (TComparable *self);</span>
<span id="cb2-13"><a href="#cb2-13"></a>  <span class="co">/* virtual function */</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="dt">int</span> (*cmp) (TComparable *self, TComparable *other);</span>
<span id="cb2-15"><a href="#cb2-15"></a>};</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">/* t_comparable_cmp */</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">/* if self &gt; other, then returns 1 */</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">/* if self = other, then returns 0 */</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">/* if self &lt; other, then returns -1 */</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">/* if error happens, then returns -2 */</span></span>
<span id="cb2-22"><a href="#cb2-22"></a></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="dt">int</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>t_comparable_cmp (TComparable *self, TComparable *other);</span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a>gboolean</span>
<span id="cb2-27"><a href="#cb2-27"></a>t_comparable_eq (TComparable *self, TComparable *other);</span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a>gboolean</span>
<span id="cb2-30"><a href="#cb2-30"></a>t_comparable_gt (TComparable *self, TComparable *other);</span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a>gboolean</span>
<span id="cb2-33"><a href="#cb2-33"></a>t_comparable_lt (TComparable *self, TComparable *other);</span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a>gboolean</span>
<span id="cb2-36"><a href="#cb2-36"></a>t_comparable_ge (TComparable *self, TComparable *other);</span>
<span id="cb2-37"><a href="#cb2-37"></a></span>
<span id="cb2-38"><a href="#cb2-38"></a>gboolean</span>
<span id="cb2-39"><a href="#cb2-39"></a>t_comparable_le (TComparable *self, TComparable *other);</span>
<span id="cb2-40"><a href="#cb2-40"></a></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="pp">#endif </span><span class="co">/* __T_COMPARABLE_H__ */</span></span></code></pre></div>
<ul>
<li>7: <code>G_DECLARE_INTERFACE</code> macro. The last parameter is a prerequisite of the interface. The prerequisite of TComparable is GObject. So, any other object than the descendants of GObject, for example GVarinat, can’t implement TComparable. A prerequisite is the GType of either an interface or a class. This macro expands to:
<ul>
<li>Declaration of <code>t_comparable_get_type()</code>.</li>
<li><code>Typedef struct _TComparableInterface TComparableInterface</code></li>
<li><code>T_COMPARABLE ()</code> macro. It casts an instance to TComparable type.</li>
<li><code>T_IS_COMPARABLE ()</code> macro. It checks if the type of an instance is <code>T_TYPE_COMPARABLE</code>.</li>
<li><code>T_COMPARABLE_GET_IFACE ()</code> macro. It gets the interface of the instance which is given as an argument.</li>
</ul></li>
<li>9-15: <code>TComparableInterface</code> structure. This is similar to a class structure. The first member is the parent interface. The parent of <code>TComparableInterface</code> is <code>GTypeInterface</code>. <code>GTypeInterface</code> is a base of all interface types. It is like a <code>GTypeClass</code> which is a base of all class types. <code>GTypeClass</code> is the first member of the structure <code>GObjectClass</code>. (See <code>gobject.h</code>. Note that <code>GObjecClass</code> is the same as <code>struct _GObjectClass</code>.) The next member is a pointer <code>arg_error</code> to the default signal handler of “arg-error” signal. This signal is emitted when an argument of the public functions isn’t TComparable. The last member is a pointer to a method <code>cmp</code>. It is a virtual function and is expected to be overridden by a function in the object which implements the interface.</li>
<li>23-39: Public functions.</li>
</ul>
<p>C file <code>tcomparable.c</code> is as follows.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1"></a><span class="pp">#include </span><span class="im">&quot;tcomparable.h&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="dt">static</span> guint t_comparable_signal;</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>G_DEFINE_INTERFACE (TComparable, t_comparable, G_TYPE_OBJECT)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>arg_error_default_cb (TComparable *self) {</span>
<span id="cb3-9"><a href="#cb3-9"></a>  g_printerr (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">TComparable: argument error.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb3-10"><a href="#cb3-10"></a>}</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>t_comparable_default_init (TComparableInterface *iface) {</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="co">/* virtual functio */</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>  iface-&gt;cmp = NULL;</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="co">/* argument error signal */</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>  iface-&gt;arg_error = arg_error_default_cb;</span>
<span id="cb3-18"><a href="#cb3-18"></a>  t_comparable_signal =</span>
<span id="cb3-19"><a href="#cb3-19"></a>  g_signal_new (<span class="st">&quot;arg-error&quot;</span>,</span>
<span id="cb3-20"><a href="#cb3-20"></a>                T_TYPE_COMPARABLE,</span>
<span id="cb3-21"><a href="#cb3-21"></a>                G_SIGNAL_RUN_LAST | G_SIGNAL_NO_RECURSE | G_SIGNAL_NO_HOOKS,</span>
<span id="cb3-22"><a href="#cb3-22"></a>                G_STRUCT_OFFSET (TComparableInterface, arg_error),</span>
<span id="cb3-23"><a href="#cb3-23"></a>                NULL <span class="co">/* accumulator */</span>,</span>
<span id="cb3-24"><a href="#cb3-24"></a>                NULL <span class="co">/* accumulator data */</span>,</span>
<span id="cb3-25"><a href="#cb3-25"></a>                NULL <span class="co">/* C marshaller */</span>,</span>
<span id="cb3-26"><a href="#cb3-26"></a>                G_TYPE_NONE <span class="co">/* return_type */</span>,</span>
<span id="cb3-27"><a href="#cb3-27"></a>                <span class="dv">0</span>     <span class="co">/* n_params */</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>                );</span>
<span id="cb3-29"><a href="#cb3-29"></a>}</span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="dt">int</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>t_comparable_cmp (TComparable *self, TComparable *other) {</span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-34"><a href="#cb3-34"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-35"><a href="#cb3-35"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), -<span class="dv">2</span>);</span>
<span id="cb3-36"><a href="#cb3-36"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), -<span class="dv">2</span>);</span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a>  <span class="dt">int</span> result;</span>
<span id="cb3-39"><a href="#cb3-39"></a>  TComparableInterface *iface = T_COMPARABLE_GET_IFACE (self);</span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a>  g_return_val_if_fail (iface-&gt;cmp, -<span class="dv">2</span>);</span>
<span id="cb3-42"><a href="#cb3-42"></a>  <span class="cf">if</span> ((result = iface-&gt;cmp (self, other)) == -<span class="dv">2</span>)</span>
<span id="cb3-43"><a href="#cb3-43"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-44"><a href="#cb3-44"></a>  <span class="cf">return</span> result;</span>
<span id="cb3-45"><a href="#cb3-45"></a>}</span>
<span id="cb3-46"><a href="#cb3-46"></a></span>
<span id="cb3-47"><a href="#cb3-47"></a>gboolean</span>
<span id="cb3-48"><a href="#cb3-48"></a>t_comparable_eq (TComparable *self, TComparable *other) {</span>
<span id="cb3-49"><a href="#cb3-49"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-50"><a href="#cb3-50"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-51"><a href="#cb3-51"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), FALSE);</span>
<span id="cb3-52"><a href="#cb3-52"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), FALSE);</span>
<span id="cb3-53"><a href="#cb3-53"></a></span>
<span id="cb3-54"><a href="#cb3-54"></a>  <span class="cf">if</span> (t_comparable_cmp (self, other) == <span class="dv">0</span>)</span>
<span id="cb3-55"><a href="#cb3-55"></a>    <span class="cf">return</span> TRUE;</span>
<span id="cb3-56"><a href="#cb3-56"></a>  <span class="cf">else</span></span>
<span id="cb3-57"><a href="#cb3-57"></a>    <span class="cf">return</span> FALSE;</span>
<span id="cb3-58"><a href="#cb3-58"></a>}</span>
<span id="cb3-59"><a href="#cb3-59"></a></span>
<span id="cb3-60"><a href="#cb3-60"></a>gboolean</span>
<span id="cb3-61"><a href="#cb3-61"></a>t_comparable_gt (TComparable *self, TComparable *other) {</span>
<span id="cb3-62"><a href="#cb3-62"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-63"><a href="#cb3-63"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-64"><a href="#cb3-64"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), FALSE);</span>
<span id="cb3-65"><a href="#cb3-65"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), FALSE);</span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a>  <span class="cf">if</span> (t_comparable_cmp (self, other) == <span class="dv">1</span>)</span>
<span id="cb3-68"><a href="#cb3-68"></a>    <span class="cf">return</span> TRUE;</span>
<span id="cb3-69"><a href="#cb3-69"></a>  <span class="cf">else</span></span>
<span id="cb3-70"><a href="#cb3-70"></a>    <span class="cf">return</span> FALSE;</span>
<span id="cb3-71"><a href="#cb3-71"></a>}</span>
<span id="cb3-72"><a href="#cb3-72"></a></span>
<span id="cb3-73"><a href="#cb3-73"></a>gboolean</span>
<span id="cb3-74"><a href="#cb3-74"></a>t_comparable_lt (TComparable *self, TComparable *other) {</span>
<span id="cb3-75"><a href="#cb3-75"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-76"><a href="#cb3-76"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-77"><a href="#cb3-77"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), FALSE);</span>
<span id="cb3-78"><a href="#cb3-78"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), FALSE);</span>
<span id="cb3-79"><a href="#cb3-79"></a></span>
<span id="cb3-80"><a href="#cb3-80"></a>  <span class="cf">if</span> (t_comparable_cmp (self, other) == -<span class="dv">1</span>)</span>
<span id="cb3-81"><a href="#cb3-81"></a>    <span class="cf">return</span> TRUE;</span>
<span id="cb3-82"><a href="#cb3-82"></a>  <span class="cf">else</span></span>
<span id="cb3-83"><a href="#cb3-83"></a>    <span class="cf">return</span> FALSE;</span>
<span id="cb3-84"><a href="#cb3-84"></a>}</span>
<span id="cb3-85"><a href="#cb3-85"></a></span>
<span id="cb3-86"><a href="#cb3-86"></a>gboolean</span>
<span id="cb3-87"><a href="#cb3-87"></a>t_comparable_ge (TComparable *self, TComparable *other) {</span>
<span id="cb3-88"><a href="#cb3-88"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-89"><a href="#cb3-89"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-90"><a href="#cb3-90"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), FALSE);</span>
<span id="cb3-91"><a href="#cb3-91"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), FALSE);</span>
<span id="cb3-92"><a href="#cb3-92"></a></span>
<span id="cb3-93"><a href="#cb3-93"></a></span>
<span id="cb3-94"><a href="#cb3-94"></a>  <span class="dt">int</span> result = t_comparable_cmp (self, other);</span>
<span id="cb3-95"><a href="#cb3-95"></a>  <span class="cf">if</span> (result == <span class="dv">1</span> || result == <span class="dv">0</span>)</span>
<span id="cb3-96"><a href="#cb3-96"></a>    <span class="cf">return</span> TRUE;</span>
<span id="cb3-97"><a href="#cb3-97"></a>  <span class="cf">else</span></span>
<span id="cb3-98"><a href="#cb3-98"></a>    <span class="cf">return</span> FALSE;</span>
<span id="cb3-99"><a href="#cb3-99"></a>}</span>
<span id="cb3-100"><a href="#cb3-100"></a></span>
<span id="cb3-101"><a href="#cb3-101"></a>gboolean</span>
<span id="cb3-102"><a href="#cb3-102"></a>t_comparable_le (TComparable *self, TComparable *other) {</span>
<span id="cb3-103"><a href="#cb3-103"></a>  <span class="cf">if</span> ((! T_IS_COMPARABLE (self)) || (! T_IS_COMPARABLE (other)))</span>
<span id="cb3-104"><a href="#cb3-104"></a>    g_signal_emit (self, t_comparable_signal, <span class="dv">0</span>);</span>
<span id="cb3-105"><a href="#cb3-105"></a>  g_return_val_if_fail (T_IS_COMPARABLE (self), FALSE);</span>
<span id="cb3-106"><a href="#cb3-106"></a>  g_return_val_if_fail (T_IS_COMPARABLE (other), FALSE);</span>
<span id="cb3-107"><a href="#cb3-107"></a></span>
<span id="cb3-108"><a href="#cb3-108"></a></span>
<span id="cb3-109"><a href="#cb3-109"></a>  <span class="dt">int</span> result = t_comparable_cmp (self, other);</span>
<span id="cb3-110"><a href="#cb3-110"></a>  <span class="cf">if</span> (result == -<span class="dv">1</span> || result == <span class="dv">0</span>)</span>
<span id="cb3-111"><a href="#cb3-111"></a>    <span class="cf">return</span> TRUE;</span>
<span id="cb3-112"><a href="#cb3-112"></a>  <span class="cf">else</span></span>
<span id="cb3-113"><a href="#cb3-113"></a>    <span class="cf">return</span> FALSE;</span>
<span id="cb3-114"><a href="#cb3-114"></a>}</span></code></pre></div>
<ul>
<li>5: <code>G_DEFINE_INTERFACE</code> macro. The third parameter is the type of the prerequisite. This macro expands to:
<ul>
<li>Declaration of <code>t_comparable_default_init ()</code>.</li>
<li>Definition of <code>t_comparable_get_type ()</code>.</li>
</ul></li>
<li>7-10: <code>arg_error_default_cb</code> is a default signal handler of “arg-error” signal.</li>
<li>12- 29: <code>t_comparable_default_init</code> function. This function is similar to class initialization function. It initializes <code>TComparableInterface</code> structure.</li>
<li>15: Assigns NULL to the pointer to <code>cmp</code> method. So, the method doesn’t work before an implementation object overrides it.</li>
<li>17: Set the default signal handler of the signal “arg-error”.</li>
<li>18-28: Creates a signal “arg-error”. This signal is emitted when an argument for a public function is invalid.</li>
<li>31-45: <code>t_comparable_cmp</code> function. First four lines (33-36) check the arguments. If one of them is invalid, it emits “arg-error” signal and outputs an error log, then returns -2. (-2 indicates an error.) If <code>iface-&gt;cmp</code> is NULL (it means the class method hasn’t been overridden), then outputs an error log and returns -2. Otherwise it calls the class method. If <code>result</code> equals -2, an error has occurred. Then, it emits “arg-error” signal. Returns <code>result</code>.</li>
<li>47-114: Public functions. These five functions are based on <code>t_comparable_cmp</code>. Therefore, no overriding is necessary for the functions. For example, <code>t_comparable_eq</code> just calls <code>t_comparable_cmp</code>. And if the return value is zero, then it returns TRUE. Otherwise it returns FALSE.</li>
</ul>
<p>This program uses a signal to give the argument type error information to a user. This error is usually a program error rather than a run-time error. Using a signal to report a program error is not a good way. The best way is using <code>g_return_if_fail</code>. The reason why I made this signal is just I wanted to show how to implement a signal in an interface.</p>
<h2 id="implementing-interface">Implementing interface</h2>
<p>TInt, TDouble, TStr and TNumStr implement TComparable. First, look at TInt. The header file is the same as before. The implementation is written in C file.</p>
<p><code>tint.c'</code>is as follows.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1"></a><span class="pp">#include </span><span class="im">&quot;tint.h&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="pp">#include </span><span class="im">&quot;tcomparable.h&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="pp">#define PROP_INT 1</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="dt">static</span> GParamSpec *int_property = NULL;</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">struct</span> _TInt {</span>
<span id="cb4-9"><a href="#cb4-9"></a>  TNumber parent;</span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="dt">int</span> value;</span>
<span id="cb4-11"><a href="#cb4-11"></a>};</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="dt">static</span> <span class="dt">void</span> t_comparable_interface_init (TComparableInterface *iface);</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>G_DEFINE_TYPE_WITH_CODE (TInt, t_int, T_TYPE_NUMBER,</span>
<span id="cb4-16"><a href="#cb4-16"></a>                         G_IMPLEMENT_INTERFACE (T_TYPE_COMPARABLE, t_comparable_interface_init))</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="dt">static</span> <span class="dt">int</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>t_int_comparable_cmp (TComparable *self, TComparable *other) {</span>
<span id="cb4-20"><a href="#cb4-20"></a>  g_return_val_if_fail (T_IS_INT (self), -<span class="dv">2</span>);</span>
<span id="cb4-21"><a href="#cb4-21"></a>  g_return_val_if_fail (T_IS_INT (other) || T_IS_DOUBLE (other), -<span class="dv">2</span>);</span>
<span id="cb4-22"><a href="#cb4-22"></a></span>
<span id="cb4-23"><a href="#cb4-23"></a>  <span class="dt">int</span> i;</span>
<span id="cb4-24"><a href="#cb4-24"></a>  <span class="dt">double</span> s, o;</span>
<span id="cb4-25"><a href="#cb4-25"></a></span>
<span id="cb4-26"><a href="#cb4-26"></a>  g_object_get (self, <span class="st">&quot;value&quot;</span>, &amp;i, NULL);</span>
<span id="cb4-27"><a href="#cb4-27"></a>  s = (<span class="dt">double</span>) i;</span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="cf">if</span> (T_IS_INT (other)) {</span>
<span id="cb4-29"><a href="#cb4-29"></a>    g_object_get (other, <span class="st">&quot;value&quot;</span>, &amp;i, NULL);</span>
<span id="cb4-30"><a href="#cb4-30"></a>    o = (<span class="dt">double</span>) i;</span>
<span id="cb4-31"><a href="#cb4-31"></a>  } <span class="cf">else</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>    g_object_get (other, <span class="st">&quot;value&quot;</span>, &amp;o, NULL);</span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="cf">if</span> (s &gt; o)</span>
<span id="cb4-34"><a href="#cb4-34"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="cf">else</span> <span class="cf">if</span> (s == o)</span>
<span id="cb4-36"><a href="#cb4-36"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb4-37"><a href="#cb4-37"></a>  <span class="cf">else</span> <span class="cf">if</span> (s &lt; o)</span>
<span id="cb4-38"><a href="#cb4-38"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb4-39"><a href="#cb4-39"></a>  <span class="cf">else</span> <span class="co">/* This can&#39;t happen. */</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>    <span class="cf">return</span> -<span class="dv">2</span>;</span>
<span id="cb4-41"><a href="#cb4-41"></a>}</span>
<span id="cb4-42"><a href="#cb4-42"></a></span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>t_comparable_interface_init (TComparableInterface *iface) {</span>
<span id="cb4-45"><a href="#cb4-45"></a>  iface-&gt;cmp = t_int_comparable_cmp;</span>
<span id="cb4-46"><a href="#cb4-46"></a>}</span>
<span id="cb4-47"><a href="#cb4-47"></a></span>
<span id="cb4-48"><a href="#cb4-48"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb4-49"><a href="#cb4-49"></a>t_int_set_property (GObject *object, guint property_id, <span class="dt">const</span> GValue *value, GParamSpec *pspec) {</span>
<span id="cb4-50"><a href="#cb4-50"></a>  TInt *self = T_INT (object);</span>
<span id="cb4-51"><a href="#cb4-51"></a></span>
<span id="cb4-52"><a href="#cb4-52"></a>  <span class="cf">if</span> (property_id == PROP_INT) {</span>
<span id="cb4-53"><a href="#cb4-53"></a>    self-&gt;value = g_value_get_int (value);</span>
<span id="cb4-54"><a href="#cb4-54"></a>  } <span class="cf">else</span></span>
<span id="cb4-55"><a href="#cb4-55"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);</span>
<span id="cb4-56"><a href="#cb4-56"></a>}</span>
<span id="cb4-57"><a href="#cb4-57"></a></span>
<span id="cb4-58"><a href="#cb4-58"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb4-59"><a href="#cb4-59"></a>t_int_get_property (GObject *object, guint property_id, GValue *value, GParamSpec *pspec) {</span>
<span id="cb4-60"><a href="#cb4-60"></a>  TInt *self = T_INT (object);</span>
<span id="cb4-61"><a href="#cb4-61"></a></span>
<span id="cb4-62"><a href="#cb4-62"></a>  <span class="cf">if</span> (property_id == PROP_INT)</span>
<span id="cb4-63"><a href="#cb4-63"></a>    g_value_set_int (value, self-&gt;value);</span>
<span id="cb4-64"><a href="#cb4-64"></a>  <span class="cf">else</span></span>
<span id="cb4-65"><a href="#cb4-65"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);</span>
<span id="cb4-66"><a href="#cb4-66"></a>}</span>
<span id="cb4-67"><a href="#cb4-67"></a></span>
<span id="cb4-68"><a href="#cb4-68"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb4-69"><a href="#cb4-69"></a>t_int_init (TInt *d) {</span>
<span id="cb4-70"><a href="#cb4-70"></a>}</span>
<span id="cb4-71"><a href="#cb4-71"></a></span>
<span id="cb4-72"><a href="#cb4-72"></a><span class="co">/* arithmetic operator */</span></span>
<span id="cb4-73"><a href="#cb4-73"></a><span class="co">/* These operators create a new instance and return a pointer to it. */</span></span>
<span id="cb4-74"><a href="#cb4-74"></a><span class="pp">#define t_int_binary_op(op) \</span></span>
<span id="cb4-75"><a href="#cb4-75"></a><span class="pp">  int i; \</span></span>
<span id="cb4-76"><a href="#cb4-76"></a><span class="pp">  double d; \</span></span>
<span id="cb4-77"><a href="#cb4-77"></a><span class="pp">  if (T_IS_INT (other)) { \</span></span>
<span id="cb4-78"><a href="#cb4-78"></a><span class="pp">    g_object_get (T_INT (other), &quot;value&quot;, &amp;i, NULL); \</span></span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="pp">    return  T_NUMBER (t_int_new_with_value (T_INT(self)-&gt;value op i)); \</span></span>
<span id="cb4-80"><a href="#cb4-80"></a><span class="pp">  } else { \</span></span>
<span id="cb4-81"><a href="#cb4-81"></a><span class="pp">    g_object_get (T_DOUBLE (other), &quot;value&quot;, &amp;d, NULL); \</span></span>
<span id="cb4-82"><a href="#cb4-82"></a><span class="pp">    return  T_NUMBER (t_int_new_with_value (T_INT(self)-&gt;value op (int) d)); \</span></span>
<span id="cb4-83"><a href="#cb4-83"></a><span class="pp">  }</span></span>
<span id="cb4-84"><a href="#cb4-84"></a></span>
<span id="cb4-85"><a href="#cb4-85"></a><span class="dt">static</span> TNumber *</span>
<span id="cb4-86"><a href="#cb4-86"></a>t_int_add (TNumber *self, TNumber *other) {</span>
<span id="cb4-87"><a href="#cb4-87"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-88"><a href="#cb4-88"></a></span>
<span id="cb4-89"><a href="#cb4-89"></a>  t_int_binary_op (+)</span>
<span id="cb4-90"><a href="#cb4-90"></a>}</span>
<span id="cb4-91"><a href="#cb4-91"></a></span>
<span id="cb4-92"><a href="#cb4-92"></a><span class="dt">static</span> TNumber *</span>
<span id="cb4-93"><a href="#cb4-93"></a>t_int_sub (TNumber *self, TNumber *other) {</span>
<span id="cb4-94"><a href="#cb4-94"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-95"><a href="#cb4-95"></a></span>
<span id="cb4-96"><a href="#cb4-96"></a>  t_int_binary_op (-)</span>
<span id="cb4-97"><a href="#cb4-97"></a>}</span>
<span id="cb4-98"><a href="#cb4-98"></a></span>
<span id="cb4-99"><a href="#cb4-99"></a><span class="dt">static</span> TNumber *</span>
<span id="cb4-100"><a href="#cb4-100"></a>t_int_mul (TNumber *self, TNumber *other) {</span>
<span id="cb4-101"><a href="#cb4-101"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-102"><a href="#cb4-102"></a></span>
<span id="cb4-103"><a href="#cb4-103"></a>  t_int_binary_op (*)</span>
<span id="cb4-104"><a href="#cb4-104"></a>}</span>
<span id="cb4-105"><a href="#cb4-105"></a></span>
<span id="cb4-106"><a href="#cb4-106"></a><span class="dt">static</span> TNumber *</span>
<span id="cb4-107"><a href="#cb4-107"></a>t_int_div (TNumber *self, TNumber *other) {</span>
<span id="cb4-108"><a href="#cb4-108"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-109"><a href="#cb4-109"></a>  <span class="dt">int</span> i;</span>
<span id="cb4-110"><a href="#cb4-110"></a>  <span class="dt">double</span> d;</span>
<span id="cb4-111"><a href="#cb4-111"></a></span>
<span id="cb4-112"><a href="#cb4-112"></a>  <span class="cf">if</span> (T_IS_INT (other)) {</span>
<span id="cb4-113"><a href="#cb4-113"></a>    g_object_get (T_INT (other), <span class="st">&quot;value&quot;</span>, &amp;i, NULL);</span>
<span id="cb4-114"><a href="#cb4-114"></a>    <span class="cf">if</span> (i == <span class="dv">0</span>) {</span>
<span id="cb4-115"><a href="#cb4-115"></a>      g_signal_emit_by_name (self, <span class="st">&quot;div-by-zero&quot;</span>);</span>
<span id="cb4-116"><a href="#cb4-116"></a>      <span class="cf">return</span> NULL;</span>
<span id="cb4-117"><a href="#cb4-117"></a>    } <span class="cf">else</span></span>
<span id="cb4-118"><a href="#cb4-118"></a>      <span class="cf">return</span>  T_NUMBER (t_int_new_with_value (T_INT(self)-&gt;value / i));</span>
<span id="cb4-119"><a href="#cb4-119"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-120"><a href="#cb4-120"></a>    g_object_get (T_DOUBLE (other), <span class="st">&quot;value&quot;</span>, &amp;d, NULL);</span>
<span id="cb4-121"><a href="#cb4-121"></a>    <span class="cf">if</span> (d == <span class="dv">0</span>) {</span>
<span id="cb4-122"><a href="#cb4-122"></a>      g_signal_emit_by_name (self, <span class="st">&quot;div-by-zero&quot;</span>);</span>
<span id="cb4-123"><a href="#cb4-123"></a>      <span class="cf">return</span> NULL;</span>
<span id="cb4-124"><a href="#cb4-124"></a>    } <span class="cf">else</span></span>
<span id="cb4-125"><a href="#cb4-125"></a>      <span class="cf">return</span>  T_NUMBER (t_int_new_with_value (T_INT(self)-&gt;value / (<span class="dt">int</span>)  d));</span>
<span id="cb4-126"><a href="#cb4-126"></a>  }</span>
<span id="cb4-127"><a href="#cb4-127"></a>}</span>
<span id="cb4-128"><a href="#cb4-128"></a></span>
<span id="cb4-129"><a href="#cb4-129"></a><span class="dt">static</span> TNumber *</span>
<span id="cb4-130"><a href="#cb4-130"></a>t_int_uminus (TNumber *self) {</span>
<span id="cb4-131"><a href="#cb4-131"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-132"><a href="#cb4-132"></a></span>
<span id="cb4-133"><a href="#cb4-133"></a>  <span class="cf">return</span> T_NUMBER (t_int_new_with_value (- T_INT(self)-&gt;value));</span>
<span id="cb4-134"><a href="#cb4-134"></a>}</span>
<span id="cb4-135"><a href="#cb4-135"></a></span>
<span id="cb4-136"><a href="#cb4-136"></a><span class="dt">static</span> <span class="dt">char</span> *</span>
<span id="cb4-137"><a href="#cb4-137"></a>t_int_to_s (TNumber *self) {</span>
<span id="cb4-138"><a href="#cb4-138"></a>  g_return_val_if_fail (T_IS_INT (self), NULL);</span>
<span id="cb4-139"><a href="#cb4-139"></a>  <span class="dt">int</span> i;</span>
<span id="cb4-140"><a href="#cb4-140"></a></span>
<span id="cb4-141"><a href="#cb4-141"></a>  g_object_get (T_INT (self), <span class="st">&quot;value&quot;</span>, &amp;i, NULL); </span>
<span id="cb4-142"><a href="#cb4-142"></a>  <span class="cf">return</span> g_strdup_printf (<span class="st">&quot;%d&quot;</span>, i);</span>
<span id="cb4-143"><a href="#cb4-143"></a>}</span>
<span id="cb4-144"><a href="#cb4-144"></a></span>
<span id="cb4-145"><a href="#cb4-145"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb4-146"><a href="#cb4-146"></a>t_int_class_init (TIntClass *class) {</span>
<span id="cb4-147"><a href="#cb4-147"></a>  TNumberClass *tnumber_class = T_NUMBER_CLASS (class);</span>
<span id="cb4-148"><a href="#cb4-148"></a>  GObjectClass *gobject_class = G_OBJECT_CLASS (class);</span>
<span id="cb4-149"><a href="#cb4-149"></a></span>
<span id="cb4-150"><a href="#cb4-150"></a>  <span class="co">/* override virtual functions */</span></span>
<span id="cb4-151"><a href="#cb4-151"></a>  tnumber_class-&gt;add = t_int_add;</span>
<span id="cb4-152"><a href="#cb4-152"></a>  tnumber_class-&gt;sub = t_int_sub;</span>
<span id="cb4-153"><a href="#cb4-153"></a>  tnumber_class-&gt;mul = t_int_mul;</span>
<span id="cb4-154"><a href="#cb4-154"></a>  tnumber_class-&gt;div = t_int_div;</span>
<span id="cb4-155"><a href="#cb4-155"></a>  tnumber_class-&gt;uminus = t_int_uminus;</span>
<span id="cb4-156"><a href="#cb4-156"></a>  tnumber_class-&gt;to_s = t_int_to_s;</span>
<span id="cb4-157"><a href="#cb4-157"></a></span>
<span id="cb4-158"><a href="#cb4-158"></a>  gobject_class-&gt;set_property = t_int_set_property;</span>
<span id="cb4-159"><a href="#cb4-159"></a>  gobject_class-&gt;get_property = t_int_get_property;</span>
<span id="cb4-160"><a href="#cb4-160"></a>  int_property = g_param_spec_int (<span class="st">&quot;value&quot;</span>, <span class="st">&quot;val&quot;</span>, <span class="st">&quot;Integer value&quot;</span>, G_MININT, G_MAXINT, <span class="dv">0</span>, G_PARAM_READWRITE);</span>
<span id="cb4-161"><a href="#cb4-161"></a>  g_object_class_install_property (gobject_class, PROP_INT, int_property);</span>
<span id="cb4-162"><a href="#cb4-162"></a>}</span>
<span id="cb4-163"><a href="#cb4-163"></a></span>
<span id="cb4-164"><a href="#cb4-164"></a>TInt *</span>
<span id="cb4-165"><a href="#cb4-165"></a>t_int_new_with_value (<span class="dt">int</span> value) {</span>
<span id="cb4-166"><a href="#cb4-166"></a>  TInt *d;</span>
<span id="cb4-167"><a href="#cb4-167"></a></span>
<span id="cb4-168"><a href="#cb4-168"></a>  d = g_object_new (T_TYPE_INT, <span class="st">&quot;value&quot;</span>, value, NULL);</span>
<span id="cb4-169"><a href="#cb4-169"></a>  <span class="cf">return</span> d;</span>
<span id="cb4-170"><a href="#cb4-170"></a>}</span>
<span id="cb4-171"><a href="#cb4-171"></a></span>
<span id="cb4-172"><a href="#cb4-172"></a>TInt *</span>
<span id="cb4-173"><a href="#cb4-173"></a>t_int_new (<span class="dt">void</span>) {</span>
<span id="cb4-174"><a href="#cb4-174"></a>  TInt *d;</span>
<span id="cb4-175"><a href="#cb4-175"></a></span>
<span id="cb4-176"><a href="#cb4-176"></a>  d = g_object_new (T_TYPE_INT, NULL);</span>
<span id="cb4-177"><a href="#cb4-177"></a>  <span class="cf">return</span> d;</span>
<span id="cb4-178"><a href="#cb4-178"></a>}</span></code></pre></div>
<ul>
<li>3: It needs to include the header file of TComparable.</li>
<li>13: Declaration of <code>t_comparable_interface_init ()</code> function. This declaration is done before <code>G_DEFINE_TYPE_WITH_CODE</code> macro.</li>
<li>15-16: <code>G_DEFINE_TYPE_WITH_CODE</code> macro. The last parameter is <code>G_IMPLEMENT_INTERFACE</code> macro. The third parameter of <code>G_IMPLEMENT_INTERFACE</code> is <code>t_comparabele_interface_init</code>. These two macros expands to:
<ul>
<li>Declares <code>t_int_class_init ()</code> function.</li>
<li>Declares <code>t_int_init ()</code> function.</li>
<li>Defines <code>t_int_parent_class</code> static variable which points to the parent’s class.</li>
<li>Defines <code>t_int_get_type ()</code> function. This function includes <code>g_type_register_static_simple ()</code> and <code>g_type_add_interface_static ()</code>. <code>g_type_register_static_simple ()</code> is a convenient version of <code>g_type_register_static ()</code>. It registers TInt type to the type system. <code>g_type_add_interface_static ()</code> adds an interface type to an instance type. There is a good example in <a href="https://docs.gtk.org/gobject/concepts.html#non-instantiatable-classed-types-interfaces">GObject Reference Manual, Interfaces</a>.</li>
</ul></li>
<li>18-41: <code>t_int_comparable_cmp</code> is a function to compare TInt instances.</li>
<li>26: Gets the value of <code>self</code> and cast it to double.</li>
<li>27-32: Gets the value of <code>other</code> and if it is TInt then the value is casted to double. If <code>other</code> is TDouble, no cast is needed.</li>
<li>33-40: compares <code>s</code> and <code>o</code> and returns 1, 0, -1 and -2.</li>
<li>43-46: <code>t_comparable_interface_init</code>. This function is called in the initialization process of TInt. <code>t_int_comparable_cmp</code> overrides <code>cmp</code> method.</li>
<li>48-178: The same as before.</li>
</ul>
<p><code>tdouble.c</code> is almost same as <code>tint.c</code>. These two objects can be compared because int is casted to double before the comparison.</p>
<p><code>tstr.c</code> is as follows.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1"></a><span class="pp">#include </span><span class="im">&quot;tstr.h&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="pp">#include </span><span class="im">&quot;tcomparable.h&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">enum</span> {</span>
<span id="cb5-5"><a href="#cb5-5"></a>  PROP_0,</span>
<span id="cb5-6"><a href="#cb5-6"></a>  PROP_STRING,</span>
<span id="cb5-7"><a href="#cb5-7"></a>  N_PROPERTIES</span>
<span id="cb5-8"><a href="#cb5-8"></a>};</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="dt">static</span> GParamSpec *str_properties[N_PROPERTIES] = {NULL, };</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="kw">typedef</span> <span class="kw">struct</span> {</span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="dt">char</span> *string;</span>
<span id="cb5-14"><a href="#cb5-14"></a>} TStrPrivate;</span>
<span id="cb5-15"><a href="#cb5-15"></a></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="dt">static</span> <span class="dt">void</span> t_comparable_interface_init (TComparableInterface *iface);</span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a>G_DEFINE_TYPE_WITH_CODE (TStr, t_str, G_TYPE_OBJECT,</span>
<span id="cb5-19"><a href="#cb5-19"></a>                         G_ADD_PRIVATE (TStr)</span>
<span id="cb5-20"><a href="#cb5-20"></a>                         G_IMPLEMENT_INTERFACE (T_TYPE_COMPARABLE, t_comparable_interface_init))</span>
<span id="cb5-21"><a href="#cb5-21"></a></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>t_str_set_property (GObject *object, guint property_id, <span class="dt">const</span> GValue *value, GParamSpec *pspec) {</span>
<span id="cb5-24"><a href="#cb5-24"></a>  TStr *self = T_STR (object);</span>
<span id="cb5-25"><a href="#cb5-25"></a>  TStrPrivate *priv = t_str_get_instance_private (self);</span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a></span>
<span id="cb5-28"><a href="#cb5-28"></a>  <span class="cf">if</span> (property_id == PROP_STRING) {</span>
<span id="cb5-29"><a href="#cb5-29"></a>    <span class="cf">if</span> (priv-&gt;string)</span>
<span id="cb5-30"><a href="#cb5-30"></a>      g_free (priv-&gt;string);</span>
<span id="cb5-31"><a href="#cb5-31"></a>    priv-&gt;string = g_strdup (g_value_get_string (value));</span>
<span id="cb5-32"><a href="#cb5-32"></a>  } <span class="cf">else</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);</span>
<span id="cb5-34"><a href="#cb5-34"></a>}</span>
<span id="cb5-35"><a href="#cb5-35"></a></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>t_str_get_property (GObject *object, guint property_id, GValue *value, GParamSpec *pspec) {</span>
<span id="cb5-38"><a href="#cb5-38"></a>  TStr *self = T_STR (object);</span>
<span id="cb5-39"><a href="#cb5-39"></a>  TStrPrivate *priv = t_str_get_instance_private (self);</span>
<span id="cb5-40"><a href="#cb5-40"></a></span>
<span id="cb5-41"><a href="#cb5-41"></a>  <span class="cf">if</span> (property_id == PROP_STRING)</span>
<span id="cb5-42"><a href="#cb5-42"></a>    g_value_set_string (value, g_strdup (priv-&gt;string));</span>
<span id="cb5-43"><a href="#cb5-43"></a>  <span class="cf">else</span></span>
<span id="cb5-44"><a href="#cb5-44"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);</span>
<span id="cb5-45"><a href="#cb5-45"></a>}</span>
<span id="cb5-46"><a href="#cb5-46"></a></span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-48"><a href="#cb5-48"></a>t_str_finalize (GObject *object) {</span>
<span id="cb5-49"><a href="#cb5-49"></a>  TStr *self = T_STR (object);</span>
<span id="cb5-50"><a href="#cb5-50"></a>  TStrPrivate *priv = t_str_get_instance_private (self);</span>
<span id="cb5-51"><a href="#cb5-51"></a></span>
<span id="cb5-52"><a href="#cb5-52"></a>  <span class="cf">if</span> (priv-&gt;string)</span>
<span id="cb5-53"><a href="#cb5-53"></a>    g_free (priv-&gt;string);</span>
<span id="cb5-54"><a href="#cb5-54"></a>  G_OBJECT_CLASS (t_str_parent_class)-&gt;finalize (object);</span>
<span id="cb5-55"><a href="#cb5-55"></a>}</span>
<span id="cb5-56"><a href="#cb5-56"></a></span>
<span id="cb5-57"><a href="#cb5-57"></a><span class="dt">static</span> <span class="dt">int</span></span>
<span id="cb5-58"><a href="#cb5-58"></a>t_str_comparable_cmp (TComparable *self, TComparable *other) {</span>
<span id="cb5-59"><a href="#cb5-59"></a>  g_return_val_if_fail (T_IS_STR (self), -<span class="dv">2</span>);</span>
<span id="cb5-60"><a href="#cb5-60"></a>  g_return_val_if_fail (T_IS_STR (other), -<span class="dv">2</span>);</span>
<span id="cb5-61"><a href="#cb5-61"></a></span>
<span id="cb5-62"><a href="#cb5-62"></a>  <span class="dt">char</span> *s, *o;</span>
<span id="cb5-63"><a href="#cb5-63"></a>  <span class="dt">int</span> result;</span>
<span id="cb5-64"><a href="#cb5-64"></a></span>
<span id="cb5-65"><a href="#cb5-65"></a>  s = t_str_get_string (T_STR (self));</span>
<span id="cb5-66"><a href="#cb5-66"></a>  o = t_str_get_string (T_STR (other));</span>
<span id="cb5-67"><a href="#cb5-67"></a></span>
<span id="cb5-68"><a href="#cb5-68"></a>  <span class="cf">if</span> (strcmp (s, o) &gt; <span class="dv">0</span>)</span>
<span id="cb5-69"><a href="#cb5-69"></a>    result = <span class="dv">1</span>;</span>
<span id="cb5-70"><a href="#cb5-70"></a>  <span class="cf">else</span> <span class="cf">if</span> (strcmp (s, o) == <span class="dv">0</span>)</span>
<span id="cb5-71"><a href="#cb5-71"></a>    result = <span class="dv">0</span>;</span>
<span id="cb5-72"><a href="#cb5-72"></a>  <span class="cf">else</span> <span class="cf">if</span> (strcmp (s, o) &lt; <span class="dv">0</span>)</span>
<span id="cb5-73"><a href="#cb5-73"></a>    result = -<span class="dv">1</span>;</span>
<span id="cb5-74"><a href="#cb5-74"></a>  <span class="cf">else</span> <span class="co">/* This can&#39;t happen. */</span></span>
<span id="cb5-75"><a href="#cb5-75"></a>    result = -<span class="dv">2</span>;</span>
<span id="cb5-76"><a href="#cb5-76"></a>  g_free (s);</span>
<span id="cb5-77"><a href="#cb5-77"></a>  g_free (o);</span>
<span id="cb5-78"><a href="#cb5-78"></a>  <span class="cf">return</span> result;</span>
<span id="cb5-79"><a href="#cb5-79"></a>}</span>
<span id="cb5-80"><a href="#cb5-80"></a></span>
<span id="cb5-81"><a href="#cb5-81"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-82"><a href="#cb5-82"></a>t_comparable_interface_init (TComparableInterface *iface) {</span>
<span id="cb5-83"><a href="#cb5-83"></a>  iface-&gt;cmp = t_str_comparable_cmp;</span>
<span id="cb5-84"><a href="#cb5-84"></a>}</span>
<span id="cb5-85"><a href="#cb5-85"></a></span>
<span id="cb5-86"><a href="#cb5-86"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-87"><a href="#cb5-87"></a>t_str_init (TStr *self) {</span>
<span id="cb5-88"><a href="#cb5-88"></a>  TStrPrivate *priv = t_str_get_instance_private (self);</span>
<span id="cb5-89"><a href="#cb5-89"></a></span>
<span id="cb5-90"><a href="#cb5-90"></a>  priv-&gt;string = NULL;</span>
<span id="cb5-91"><a href="#cb5-91"></a>}</span>
<span id="cb5-92"><a href="#cb5-92"></a></span>
<span id="cb5-93"><a href="#cb5-93"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-94"><a href="#cb5-94"></a>t_str_class_init (TStrClass *class) {</span>
<span id="cb5-95"><a href="#cb5-95"></a>  GObjectClass *gobject_class = G_OBJECT_CLASS (class);</span>
<span id="cb5-96"><a href="#cb5-96"></a></span>
<span id="cb5-97"><a href="#cb5-97"></a>  gobject_class-&gt;finalize = t_str_finalize;</span>
<span id="cb5-98"><a href="#cb5-98"></a>  gobject_class-&gt;set_property = t_str_set_property;</span>
<span id="cb5-99"><a href="#cb5-99"></a>  gobject_class-&gt;get_property = t_str_get_property;</span>
<span id="cb5-100"><a href="#cb5-100"></a>  str_properties[PROP_STRING] = g_param_spec_string (<span class="st">&quot;string&quot;</span>, <span class="st">&quot;str&quot;</span>, <span class="st">&quot;string&quot;</span>, <span class="st">&quot;&quot;</span>, G_PARAM_READWRITE);</span>
<span id="cb5-101"><a href="#cb5-101"></a>  g_object_class_install_properties (gobject_class, N_PROPERTIES, str_properties);</span>
<span id="cb5-102"><a href="#cb5-102"></a>}</span>
<span id="cb5-103"><a href="#cb5-103"></a></span>
<span id="cb5-104"><a href="#cb5-104"></a><span class="co">/* setter and getter */</span></span>
<span id="cb5-105"><a href="#cb5-105"></a><span class="dt">void</span></span>
<span id="cb5-106"><a href="#cb5-106"></a>t_str_set_string (TStr *self, <span class="dt">const</span> <span class="dt">char</span> *s) {</span>
<span id="cb5-107"><a href="#cb5-107"></a>  g_return_if_fail (T_IS_STR (self));</span>
<span id="cb5-108"><a href="#cb5-108"></a></span>
<span id="cb5-109"><a href="#cb5-109"></a>  g_object_set (self, <span class="st">&quot;string&quot;</span>, s, NULL);</span>
<span id="cb5-110"><a href="#cb5-110"></a>}</span>
<span id="cb5-111"><a href="#cb5-111"></a></span>
<span id="cb5-112"><a href="#cb5-112"></a><span class="dt">char</span> *</span>
<span id="cb5-113"><a href="#cb5-113"></a>t_str_get_string (TStr *self) {</span>
<span id="cb5-114"><a href="#cb5-114"></a>  g_return_val_if_fail (T_IS_STR (self), NULL);</span>
<span id="cb5-115"><a href="#cb5-115"></a></span>
<span id="cb5-116"><a href="#cb5-116"></a>  <span class="dt">char</span> *s;</span>
<span id="cb5-117"><a href="#cb5-117"></a></span>
<span id="cb5-118"><a href="#cb5-118"></a>  g_object_get (self, <span class="st">&quot;string&quot;</span>, &amp;s, NULL);</span>
<span id="cb5-119"><a href="#cb5-119"></a>  <span class="cf">return</span> s;</span>
<span id="cb5-120"><a href="#cb5-120"></a>}</span>
<span id="cb5-121"><a href="#cb5-121"></a></span>
<span id="cb5-122"><a href="#cb5-122"></a>TStr *</span>
<span id="cb5-123"><a href="#cb5-123"></a>t_str_concat (TStr *self, TStr *other) {</span>
<span id="cb5-124"><a href="#cb5-124"></a>  g_return_val_if_fail (T_IS_STR (self), NULL);</span>
<span id="cb5-125"><a href="#cb5-125"></a>  g_return_val_if_fail (T_IS_STR (other), NULL);</span>
<span id="cb5-126"><a href="#cb5-126"></a></span>
<span id="cb5-127"><a href="#cb5-127"></a>  <span class="dt">char</span> *s1, *s2, *s3;</span>
<span id="cb5-128"><a href="#cb5-128"></a>  TStr *str;</span>
<span id="cb5-129"><a href="#cb5-129"></a></span>
<span id="cb5-130"><a href="#cb5-130"></a>  s1 = t_str_get_string (self);</span>
<span id="cb5-131"><a href="#cb5-131"></a>  s2 = t_str_get_string (other);</span>
<span id="cb5-132"><a href="#cb5-132"></a>  <span class="cf">if</span> (s1 &amp;&amp; s2)</span>
<span id="cb5-133"><a href="#cb5-133"></a>    s3 = g_strconcat (s1, s2, NULL);</span>
<span id="cb5-134"><a href="#cb5-134"></a>  <span class="cf">else</span> <span class="cf">if</span> (s1)</span>
<span id="cb5-135"><a href="#cb5-135"></a>    s3 = g_strdup (s1);</span>
<span id="cb5-136"><a href="#cb5-136"></a>  <span class="cf">else</span> <span class="cf">if</span> (s2)</span>
<span id="cb5-137"><a href="#cb5-137"></a>    s3 = g_strdup (s2);</span>
<span id="cb5-138"><a href="#cb5-138"></a>  <span class="cf">else</span></span>
<span id="cb5-139"><a href="#cb5-139"></a>    s3 = NULL;</span>
<span id="cb5-140"><a href="#cb5-140"></a>  str = t_str_new_with_string (s3);</span>
<span id="cb5-141"><a href="#cb5-141"></a>  <span class="cf">if</span> (s1) g_free (s1);</span>
<span id="cb5-142"><a href="#cb5-142"></a>  <span class="cf">if</span> (s2) g_free (s2);</span>
<span id="cb5-143"><a href="#cb5-143"></a>  <span class="cf">if</span> (s3) g_free (s3);</span>
<span id="cb5-144"><a href="#cb5-144"></a>  <span class="cf">return</span> str;</span>
<span id="cb5-145"><a href="#cb5-145"></a>}</span>
<span id="cb5-146"><a href="#cb5-146"></a></span>
<span id="cb5-147"><a href="#cb5-147"></a><span class="co">/* create a new TStr instance */</span></span>
<span id="cb5-148"><a href="#cb5-148"></a>TStr *</span>
<span id="cb5-149"><a href="#cb5-149"></a>t_str_new_with_string (<span class="dt">const</span> <span class="dt">char</span> *s) {</span>
<span id="cb5-150"><a href="#cb5-150"></a>  <span class="cf">return</span> T_STR (g_object_new (T_TYPE_STR, <span class="st">&quot;string&quot;</span>, s, NULL));</span>
<span id="cb5-151"><a href="#cb5-151"></a>}</span>
<span id="cb5-152"><a href="#cb5-152"></a></span>
<span id="cb5-153"><a href="#cb5-153"></a>TStr *</span>
<span id="cb5-154"><a href="#cb5-154"></a>t_str_new (<span class="dt">void</span>) {</span>
<span id="cb5-155"><a href="#cb5-155"></a>  <span class="cf">return</span> T_STR (g_object_new (T_TYPE_STR, NULL));</span>
<span id="cb5-156"><a href="#cb5-156"></a>}</span></code></pre></div>
<ul>
<li>16: Declares <code>t_comparable_interface_init</code> function. This needs to be declared before <code>G_DEFINE_TYPE_WITH_CODE</code> macro.</li>
<li>18-20: <code>G_DEFINE_TYPE_WITH_CODE</code> macro. Because TStr is derivable type, its private area (TStrPrivate) is needed. <code>G_ADD_PRIVATE</code> macro makes the private area. Be careful that there’s no comma after <code>G_ADD_PRIVATE</code> macro.</li>
<li>57-79: <code>t_str_comparable_cmp</code>. First, strings <code>s</code> and <code>o</code> are got from TStr objects <code>self</code> and <code>other</code>. Then, the C standard function <code>strcmp</code> is used to compare strings. After that, <code>s</code> and <code>o</code> are freed.</li>
</ul>
<p>TStr can be compared with TStr, but not with TInt nor TDouble. Generally, comparison is available between two same type instances.</p>
<p>TNumStr implements TComparable. The program <code>tnumstr.c</code> is similar to <code>tint.c</code>. Its <code>cmp</code> function compares two numeric strings based on their numbers. Therefore, “100” is bigger than “50”. (If you compare them as TStr, “100” is smaller than “50”.) The source file is in the <code>src/tcomparable</code> directory. If you want to know the details, see `src/tcomparable/tnumstr.c.</p>
<h2 id="test-program.">Test program.</h2>
<p><code>main.c</code> is a test program.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="pp">#include </span><span class="im">&quot;tcomparable.h&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="pp">#include </span><span class="im">&quot;tnumber.h&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="pp">#include </span><span class="im">&quot;tint.h&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="pp">#include </span><span class="im">&quot;tstr.h&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="pp">#include </span><span class="im">&quot;tnumstr.h&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>notify_cb (GObject *gobject, GParamSpec *pspec, gpointer user_data) {</span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="dt">const</span> <span class="dt">char</span> *name;</span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="dt">int</span> i;</span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="dt">double</span> d;</span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="dt">char</span> *s;</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a>  name = g_param_spec_get_name (pspec);</span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="cf">if</span> (T_IS_INT (gobject) &amp;&amp; strcmp (name, <span class="st">&quot;value&quot;</span>) == <span class="dv">0</span>) {</span>
<span id="cb6-19"><a href="#cb6-19"></a>    g_object_get (T_INT (gobject), <span class="st">&quot;value&quot;</span>, &amp;i, NULL);</span>
<span id="cb6-20"><a href="#cb6-20"></a>    g_print (<span class="st">&quot;Property </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st"> is set to %d.</span><span class="sc">\n</span><span class="st">&quot;</span>, name, i);</span>
<span id="cb6-21"><a href="#cb6-21"></a>  } <span class="cf">else</span> <span class="cf">if</span> (T_IS_DOUBLE (gobject) &amp;&amp; strcmp (name, <span class="st">&quot;value&quot;</span>) == <span class="dv">0</span>) {</span>
<span id="cb6-22"><a href="#cb6-22"></a>    g_object_get (T_DOUBLE (gobject), <span class="st">&quot;value&quot;</span>, &amp;d, NULL);</span>
<span id="cb6-23"><a href="#cb6-23"></a>    g_print (<span class="st">&quot;Property </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st"> is set to %lf.</span><span class="sc">\n</span><span class="st">&quot;</span>, name, d);</span>
<span id="cb6-24"><a href="#cb6-24"></a>  } <span class="cf">else</span> <span class="cf">if</span> (T_IS_STR (gobject) &amp;&amp; strcmp (name, <span class="st">&quot;string&quot;</span>) == <span class="dv">0</span>) {</span>
<span id="cb6-25"><a href="#cb6-25"></a>    s = t_str_get_string (T_STR (gobject));</span>
<span id="cb6-26"><a href="#cb6-26"></a>    g_print (<span class="st">&quot;Property </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st"> is set to %s.</span><span class="sc">\n</span><span class="st">&quot;</span>, name, s);</span>
<span id="cb6-27"><a href="#cb6-27"></a>  }</span>
<span id="cb6-28"><a href="#cb6-28"></a>}</span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>t_print (<span class="dt">const</span> <span class="dt">char</span> *cmp, TComparable *c1, TComparable *c2) {</span>
<span id="cb6-32"><a href="#cb6-32"></a>  <span class="dt">char</span> *s1, *s2;</span>
<span id="cb6-33"><a href="#cb6-33"></a></span>
<span id="cb6-34"><a href="#cb6-34"></a>  <span class="cf">if</span> (T_IS_NUMBER (c1))</span>
<span id="cb6-35"><a href="#cb6-35"></a>    s1 = t_number_to_s (T_NUMBER (c1));</span>
<span id="cb6-36"><a href="#cb6-36"></a>  <span class="cf">else</span> <span class="cf">if</span> (T_IS_STR (c1))</span>
<span id="cb6-37"><a href="#cb6-37"></a>    s1 = t_str_get_string (T_STR (c1));</span>
<span id="cb6-38"><a href="#cb6-38"></a>  <span class="cf">else</span> {</span>
<span id="cb6-39"><a href="#cb6-39"></a>    g_print (<span class="st">&quot;c1 isn&#39;t TInt, TDouble nor TStr.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb6-40"><a href="#cb6-40"></a>    <span class="cf">return</span>;</span>
<span id="cb6-41"><a href="#cb6-41"></a>  }</span>
<span id="cb6-42"><a href="#cb6-42"></a>  <span class="cf">if</span> (T_IS_NUMBER (c2))</span>
<span id="cb6-43"><a href="#cb6-43"></a>    s2 = t_number_to_s (T_NUMBER (c2));</span>
<span id="cb6-44"><a href="#cb6-44"></a>  <span class="cf">else</span> <span class="cf">if</span> (T_IS_STR (c2))</span>
<span id="cb6-45"><a href="#cb6-45"></a>    s2 = t_str_get_string (T_STR (c2));</span>
<span id="cb6-46"><a href="#cb6-46"></a>  <span class="cf">else</span> {</span>
<span id="cb6-47"><a href="#cb6-47"></a>    g_print (<span class="st">&quot;c2 isn&#39;t TInt, TDouble nor TStr.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb6-48"><a href="#cb6-48"></a>    <span class="cf">return</span>;</span>
<span id="cb6-49"><a href="#cb6-49"></a>  }</span>
<span id="cb6-50"><a href="#cb6-50"></a>  <span class="cf">if</span> (T_IS_STR (c1))</span>
<span id="cb6-51"><a href="#cb6-51"></a>    g_print (<span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st"> %s </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span>, s1, cmp, s2);</span>
<span id="cb6-52"><a href="#cb6-52"></a>  <span class="cf">else</span></span>
<span id="cb6-53"><a href="#cb6-53"></a>    g_print (<span class="st">&quot;%s %s %s.</span><span class="sc">\n</span><span class="st">&quot;</span>, s1, cmp, s2);</span>
<span id="cb6-54"><a href="#cb6-54"></a>  g_free (s1);</span>
<span id="cb6-55"><a href="#cb6-55"></a>  g_free (s2);</span>
<span id="cb6-56"><a href="#cb6-56"></a>}    </span>
<span id="cb6-57"><a href="#cb6-57"></a></span>
<span id="cb6-58"><a href="#cb6-58"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb6-59"><a href="#cb6-59"></a>compare (TComparable *c1, TComparable *c2) {</span>
<span id="cb6-60"><a href="#cb6-60"></a>  <span class="cf">if</span> (t_comparable_eq (c1, c2))</span>
<span id="cb6-61"><a href="#cb6-61"></a>    t_print (<span class="st">&quot;equals&quot;</span>, c1, c2);</span>
<span id="cb6-62"><a href="#cb6-62"></a>  <span class="cf">if</span> (t_comparable_gt (c1, c2))</span>
<span id="cb6-63"><a href="#cb6-63"></a>    t_print (<span class="st">&quot;is greater than&quot;</span>, c1, c2);</span>
<span id="cb6-64"><a href="#cb6-64"></a>  <span class="cf">if</span> (t_comparable_lt (c1, c2))</span>
<span id="cb6-65"><a href="#cb6-65"></a>    t_print (<span class="st">&quot;is less than&quot;</span>, c1, c2);</span>
<span id="cb6-66"><a href="#cb6-66"></a>  <span class="cf">if</span> (t_comparable_ge (c1, c2))</span>
<span id="cb6-67"><a href="#cb6-67"></a>    t_print (<span class="st">&quot;is greater than or equal to&quot;</span>, c1, c2);</span>
<span id="cb6-68"><a href="#cb6-68"></a>  <span class="cf">if</span> (t_comparable_le (c1, c2))</span>
<span id="cb6-69"><a href="#cb6-69"></a>    t_print (<span class="st">&quot;is less than or equal to&quot;</span>, c1, c2);</span>
<span id="cb6-70"><a href="#cb6-70"></a>}</span>
<span id="cb6-71"><a href="#cb6-71"></a></span>
<span id="cb6-72"><a href="#cb6-72"></a><span class="dt">int</span></span>
<span id="cb6-73"><a href="#cb6-73"></a>main (<span class="dt">int</span> argc, <span class="dt">char</span> **argv) {</span>
<span id="cb6-74"><a href="#cb6-74"></a>  <span class="dt">const</span> <span class="dt">char</span> *one = <span class="st">&quot;one&quot;</span>;</span>
<span id="cb6-75"><a href="#cb6-75"></a>  <span class="dt">const</span> <span class="dt">char</span> *two = <span class="st">&quot;two&quot;</span>;</span>
<span id="cb6-76"><a href="#cb6-76"></a>  TInt *i;</span>
<span id="cb6-77"><a href="#cb6-77"></a>  TDouble *d;</span>
<span id="cb6-78"><a href="#cb6-78"></a>  TStr *str1, *str2;</span>
<span id="cb6-79"><a href="#cb6-79"></a>  TNumStr *numstr1, *numstr2;</span>
<span id="cb6-80"><a href="#cb6-80"></a>  gpointer obj;</span>
<span id="cb6-81"><a href="#cb6-81"></a></span>
<span id="cb6-82"><a href="#cb6-82"></a>  i = t_int_new ();</span>
<span id="cb6-83"><a href="#cb6-83"></a>  d = t_double_new ();</span>
<span id="cb6-84"><a href="#cb6-84"></a>  str1 = t_str_new ();</span>
<span id="cb6-85"><a href="#cb6-85"></a>  str2 = t_str_new ();</span>
<span id="cb6-86"><a href="#cb6-86"></a>  numstr1 = t_num_str_new ();</span>
<span id="cb6-87"><a href="#cb6-87"></a>  numstr2 = t_num_str_new ();</span>
<span id="cb6-88"><a href="#cb6-88"></a>  obj = g_object_new (G_TYPE_OBJECT, NULL);</span>
<span id="cb6-89"><a href="#cb6-89"></a></span>
<span id="cb6-90"><a href="#cb6-90"></a>  g_signal_connect (G_OBJECT (i), <span class="st">&quot;notify::value&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-91"><a href="#cb6-91"></a>  g_signal_connect (G_OBJECT (d), <span class="st">&quot;notify::value&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-92"><a href="#cb6-92"></a>  g_signal_connect (G_OBJECT (str1), <span class="st">&quot;notify::string&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-93"><a href="#cb6-93"></a>  g_signal_connect (G_OBJECT (str2), <span class="st">&quot;notify::string&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-94"><a href="#cb6-94"></a>  g_signal_connect (G_OBJECT (numstr1), <span class="st">&quot;notify::string&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-95"><a href="#cb6-95"></a>  g_signal_connect (G_OBJECT (numstr2), <span class="st">&quot;notify::string&quot;</span>, G_CALLBACK (notify_cb), NULL);</span>
<span id="cb6-96"><a href="#cb6-96"></a></span>
<span id="cb6-97"><a href="#cb6-97"></a>  g_object_set (i, <span class="st">&quot;value&quot;</span>, <span class="dv">124</span>, NULL);</span>
<span id="cb6-98"><a href="#cb6-98"></a>  g_object_set (d, <span class="st">&quot;value&quot;</span>, <span class="fl">123.45</span>, NULL);</span>
<span id="cb6-99"><a href="#cb6-99"></a>  t_str_set_string (str1, one);</span>
<span id="cb6-100"><a href="#cb6-100"></a>  t_str_set_string (str2, two);</span>
<span id="cb6-101"><a href="#cb6-101"></a>  t_num_str_set (numstr1, T_NUMBER (i));</span>
<span id="cb6-102"><a href="#cb6-102"></a>  t_num_str_set (numstr2, T_NUMBER (d));</span>
<span id="cb6-103"><a href="#cb6-103"></a></span>
<span id="cb6-104"><a href="#cb6-104"></a>  compare (T_COMPARABLE (i), T_COMPARABLE (d));</span>
<span id="cb6-105"><a href="#cb6-105"></a>  compare (T_COMPARABLE (str1), T_COMPARABLE (str2));</span>
<span id="cb6-106"><a href="#cb6-106"></a>  compare (T_COMPARABLE (numstr1), T_COMPARABLE (numstr2));</span>
<span id="cb6-107"><a href="#cb6-107"></a>  t_comparable_eq (T_COMPARABLE (d), obj);</span>
<span id="cb6-108"><a href="#cb6-108"></a></span>
<span id="cb6-109"><a href="#cb6-109"></a>  g_print (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb6-110"><a href="#cb6-110"></a>  t_str_set_string (str1, <span class="st">&quot;100&quot;</span>);</span>
<span id="cb6-111"><a href="#cb6-111"></a>  t_str_set_string (str2, <span class="st">&quot;50&quot;</span>);</span>
<span id="cb6-112"><a href="#cb6-112"></a>  t_str_set_string (T_STR (numstr1), <span class="st">&quot;100&quot;</span>);</span>
<span id="cb6-113"><a href="#cb6-113"></a>  t_str_set_string (T_STR (numstr2), <span class="st">&quot;50&quot;</span>);</span>
<span id="cb6-114"><a href="#cb6-114"></a>  compare (T_COMPARABLE (str1), T_COMPARABLE (str2));</span>
<span id="cb6-115"><a href="#cb6-115"></a>  compare (T_COMPARABLE (numstr1), T_COMPARABLE (numstr2));</span>
<span id="cb6-116"><a href="#cb6-116"></a></span>
<span id="cb6-117"><a href="#cb6-117"></a>  g_object_unref (i);</span>
<span id="cb6-118"><a href="#cb6-118"></a>  g_object_unref (d);</span>
<span id="cb6-119"><a href="#cb6-119"></a>  g_object_unref (str1);</span>
<span id="cb6-120"><a href="#cb6-120"></a>  g_object_unref (str2);</span>
<span id="cb6-121"><a href="#cb6-121"></a>  g_object_unref (numstr1);</span>
<span id="cb6-122"><a href="#cb6-122"></a>  g_object_unref (numstr2);</span>
<span id="cb6-123"><a href="#cb6-123"></a>  g_object_unref (obj);</span>
<span id="cb6-124"><a href="#cb6-124"></a></span>
<span id="cb6-125"><a href="#cb6-125"></a>  <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb6-126"><a href="#cb6-126"></a>}</span></code></pre></div>
<ul>
<li>10-28: “notify” signal handler is extended to support three types of objects: TInt, TDouble and TStr. Because TNumStr is a child of TStr, TNumStr instance is also supported.</li>
<li>30-56: This function <code>t_print</code> uses <code>to_s</code> function to convert TInt and/or TDouble to a string. Then, displays the result of the comparison of two TComparable objects.</li>
<li>58-70: <code>compare</code> compares two TComparable objects and calls <code>t_print</code> to display the result.</li>
<li>72-125: <code>main</code> function.</li>
<li>82-88: Creates TInt, TDouble, two TStr, two TNumStr and GObject instances.</li>
<li>90-95: Connects “notify” signal.</li>
<li>97-102: Set values and strings of TInt, TDouble, TStr and TNumStr.</li>
<li>104: Compares TInt and TDouble.</li>
<li>105: Compares two TStr.</li>
<li>106: Compares two TNumStr.</li>
<li>107: Check equality between TDouble and GObject. This makes an error because GObject doesn’t implement TComparable.</li>
<li>109-115: Compare “100” and “50” as TStr first, then as TNumStr. “100” is smaller than “50” if they are TStr. “100” is bigger than “50” if they are TNumStr.</li>
<li>117-123: Frees objects.</li>
</ul>
<h2 id="compilation-and-execution">Compilation and execution</h2>
<p>Change your current directory to src/tcomparable.</p>
<pre><code>$ meson _build
$ ninja -C _build</code></pre>
<p>Then execute it.</p>
<pre><code>$ cd tcomparable; _build/tcomparable
Property &quot;value&quot; is set to 124.
Property &quot;value&quot; is set to 123.450000.
Property &quot;string&quot; is set to one.
Property &quot;string&quot; is set to two.
Property &quot;string&quot; is set to 124.
Property &quot;string&quot; is set to 123.450000.
124 is greater than 123.450000.
124 is greater than or equal to 123.450000.
&quot;one&quot; is less than &quot;two&quot;.
&quot;one&quot; is less than or equal to &quot;two&quot;.
&quot;124&quot; is greater than &quot;123.450000&quot;.
&quot;124&quot; is greater than or equal to &quot;123.450000&quot;.

TComparable: argument error.

** (process:7737): CRITICAL **: 13:08:42.673: t_comparable_eq: assertion &#39;T_IS_COMPARABLE (other)&#39; failed

Property &quot;string&quot; is set to 100.
Property &quot;string&quot; is set to 50.
Property &quot;string&quot; is set to 100.
Property &quot;string&quot; is set to 50.
&quot;100&quot; is less than &quot;50&quot;.
&quot;100&quot; is less than or equal to &quot;50&quot;.
&quot;100&quot; is greater than &quot;50&quot;.
&quot;100&quot; is greater than or equal to &quot;50&quot;.</code></pre>
<p>The lines from <code>TComparable: argument error.</code> to <code>** (process:7737)...</code> show that the comparison with TDouble and GObject fails.</p>
<h2 id="build-an-interface-without-macros">Build an interface without macros</h2>
<p>We used macros such as <code>G_DECLARE_INTERFACE</code>, <code>G_DEFINE_INTERFACE</code> to build an interface. We can also build it without macros. There are two files in the <code>tcomparable</code> directory.</p>
<ul>
<li><code>tcomparable_without_macro.h</code></li>
<li><code>tcomparable_without_macro.c</code></li>
</ul>
<p>These two files don’t use the macros. Instead, they register the interface to the type system directly. If you want to know that, see the source files in src/tcomparable.</p>
<h2 id="gobject-system-and-object-oriented-languages">GObject system and object oriented languages</h2>
<p>If you know any object oriented languages, you probably have thought that GObject and the language are similar. Learning such languages is very useful to know GObject system.</p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
  </html>
